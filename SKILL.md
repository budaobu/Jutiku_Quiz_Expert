---
name: Quiz_Expert
description: 专门用于从文档生成结构化试题的智能体。分析内容属性（大纲型 vs 知识型），提取关键点，并生成 JSON 和 Markdown 格式的高质量试题。当用户要求“根据文件出题”、“创建测验”、“制作试卷”或“提取考题”时使用此技能。
---

# 出题专家 (Quiz Expert)

本技能将引导你完成从源文档生成专业题库的全过程。

## 工作流程 (Workflow)

### 1. 文件定位与准备
1.  **定位源文件**：在当前工作目录下查找用户指定的文件。
    - 如果用户提供的是模糊名称，请查找最匹配的文件。
2.  **格式转换**：
    - 如果文件**不是** `.md` 格式（例如 .doc, .docx, .pdf）：
        - **环境检查**：检查是否已安装 `node` 和 `npm`。如果未安装，请根据操作系统执行以下步骤：
            - **Windows**: 以管理员身份运行 PowerShell 并执行: `scripts/install_node_win.ps1`
            - **macOS**: 在终端执行: `bash scripts/install_node_mac.sh`
            - **Linux**: 在终端执行: `bash scripts/install_node_linux.sh`
        - **工具检查与安装**：
            - 检查是否已安装 `markitdown`。
            - 如果未安装，运行：`npx skills add https://github.com/davila7/claude-code-templates --skill markitdown -g -y`
        - **转换**：使用 `markitdown` 将文件转换为 Markdown 格式。
        - **保存**：将转换后的文件保存为 `{工作目录}/temp/{同文件名}.md`。
    - 如果已经是 `.md` 文件，则直接进行下一步。

### 2. 内容预处理与分析
1.  **读取与分块检查**：
    - 读取 `.md` 文件内容。
    - **智能分块 (Smart Chunking)**：检查文本长度。
        - **如果 字符数 > 15,000**：
            - **切分策略**：按 Markdown 二级标题 (`##`) 或三级标题 (`###`) 将文档切分为多个逻辑块 (Chunks)。确保切分点不破坏段落完整性。
            - **配额分配**：根据各块的篇幅比例或重要性，分配题目生成数量（如总共 20 题，A 章节占 20% 篇幅，则分配 4 题）。
            - **执行模式**：标记为 `Batch_Mode`，后续将对每个块独立生成并合并。
        - **否则**：保持单一大文本，标记为 `Single_Mode`。

2.  **属性打分**：分析文本结构和内容（若是分块模式，取前 30% 内容或摘要进行分析），判断其类型（分值 0.0 - 1.0）：
    - **大纲型 (Outline-oriented)**：具有结构化的标题、要点、简短摘要。
    - **知识/资料型 (Knowledge/Data-oriented)**：密集的段落、详细的解释、事实、数据。

3.  **策略选择**：
    - **如果 大纲型得分 > 0.7**：使用 **大纲扩展模式**。
        - 提取大纲结构。
        - 针对每个关键点/标题，生成涵盖核心概念的题目。
    - **如果 知识型得分 > 0.7**：使用 **全覆盖模式**。
        - 分析全文内容（或逐个处理块）。
        - 生成覆盖整个内容范围的题目，确保没有遗漏重要信息。
    - **否则**：使用平衡方法。

### 3. 题目生成规则
根据选定的策略生成题目，必须严格遵守 `references/QUIZ_JSON.md` 和 `references/QUIZ_MARKDOWN.md` 中定义的**生成规则与约束**。

主要约束包括：
- **题型**：单选、多选、判断、填空、简答。
- **判断题**：选项固定为“正确”和“错误”。
- **难度**：按 3:5:2 比例分布简单、中等、困难题目。
- **结构**：确保所有必填字段完整（qid, type, explanation 等）。

### 4. 质量验证与修正 (New)
在生成题目之后，必须执行自我审查循环 (Self-Correction Loop)，确保题目质量：

1.  **准确性核查 (Fact Check)**：
    - 针对每一道题，**回溯原文**。
    - 验证：正确答案是否能从原文中找到明确依据？
    - 修正：如果发现幻觉或推断过度，必须根据原文修正答案或删除该题。
2.  **逻辑性核查 (Logic Check)**：
    - 检查选项：是否存在歧义？干扰项是否过于明显错误？
    - 检查解析：`explanation` 是否清晰解释了为什么选 A 而不选 B？
3.  **格式核查 (Format Check)**：
    - 验证 JSON 结构是否符合 Schema。
    - 确保所有必需字段 (`qid`, `lev`, `point` 等) 均已填充且类型正确。

### 5. 输出生成
你 **必须** 在 `{工作目录}/quiz/` 目录下输出两个文件（如果目录不存在则创建）。

#### 文件 1: JSON 格式
- **路径**：`{工作目录}/quiz/{YYYY-MM-DD_HHMMSS}.json`
- **格式**：遵循严格的 JSON 语法。
- **参考**：参见 `references/QUIZ_JSON.md` 查看 Schema 规范。

#### 文件 2: Markdown 格式
- **路径**：`{工作目录}/quiz/{YYYY-MM-DD_HHMMSS}.md`
- **格式**：用户友好的可读格式。
- **参考**：参见 `references/QUIZ_MARKDOWN.md` 查看模板。

## 工具与命令
- 使用 `ls` 和 `find` 查找文件。
- 使用 `markitdown` 进行格式转换。
- 使用 `write` 保存最终输出文件。

## 用户请求示例
> "根据 `2023年度报告.pdf` 生成 20 道题目"

1. **查找**：`2023年度报告.pdf`。
2. **转换**：`markitdown 2023年度报告.pdf > temp/2023年度报告.md`。
3. **分析**：数据密集 -> 知识型模式。
4. **生成**：创建 20 道题目（财务统计、战略目标等）。
5. **输出**：保存到 `quiz/2024-01-29_100000.json` 和 `.md`。
